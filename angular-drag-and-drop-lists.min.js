/**
 * angular-drag-and-drop-lists v2.1.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
!function(e){function n(e,n){return"all"==n?e:e.filter(function(e){return n.toLowerCase().indexOf(e)!=-1})}var r="application/x-dnd",a="application/json",t="Text",d=["move","copy","link"]
e.directive("dndDraggable",["$parse","$timeout",function(e,l){return function(i,s,g){var c="dndDragging",f="dndDraggingSource"
g.dndClassForDragging&&(c=g.dndClassForDragging,i.$watch(g.dndClassForDragging,function(){c=g.dndClassForDragging})),g.dndClassForDraggingSource&&(f=g.dndClassForDraggingSource,i.$watch(g.dndClassForDraggingSource,function(){f=g.dndClassForDraggingSource})),s.attr("draggable","true"),g.dndDisableIf&&i.$watch(g.dndDisableIf,function(e){s.attr("draggable",!e)}),s.on("dragstart",function(u){if(u=u.originalEvent||u,"false"==s.attr("draggable"))return!0
var v=s.parent().length&&s.parent()[0].hasAttribute("dnd-list")
o.isDragging=!0,o.itemType=g.dndType&&i.$eval(g.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=g.dndEffectAllowed||d[0],u.dataTransfer.effectAllowed=o.effectAllowed
var p=i.$eval(g.dndDraggable),D=r+(o.itemType?"-"+o.itemType:"")
try{u.dataTransfer.setData(D,angular.toJson(p))}catch(e){var y=angular.toJson({item:p,type:o.itemType})
try{u.dataTransfer.setData(a,y)}catch(e){var h=n(d,o.effectAllowed)
u.dataTransfer.effectAllowed=h[0],u.dataTransfer.setData(t,y)}}if(s.addClass(c),v?o.currentDragItem={element:s,draggingSourceClass:f}:l(function(){s.addClass(f)},0),u._dndHandle&&u.dataTransfer.setDragImage&&u.dataTransfer.setDragImage(s[0],0,0),e(g.dndDragstart)(i,{event:u}),i.$evalAsync(),g.dndCallback){var C=e(g.dndCallback)
o.callback=function(e){return C(i,e||{})}}u.stopPropagation()}),s.on("dragend",function(n){n=n.originalEvent||n,i.$apply(function(){var r=o.dropEffect,a={copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}
e(g[a[r]])(i,{event:n}),e(g.dndDragend)(i,{event:n,dropEffect:r})}),o.isDragging=!1,o.callback=void 0,o.currentDragItem=void 0,s.removeClass(c),s.removeClass(f),n.stopPropagation(),l(function(){s.removeClass(f)},0)}),s.on("click",function(n){g.dndSelected&&(n=n.originalEvent||n,i.$apply(function(){e(g.dndSelected)(i,{event:n})}),n.stopPropagation())}),s.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse",function(e){return function(l,i,s){function g(e){if(!e)return t
for(var n=0;n<e.length;n++)if(e[n]==t||e[n]==a||e[n].substr(0,r.length)==r)return e[n]
return null}function c(e){return o.isDragging?o.itemType||void 0:e==t||e==a?null:e&&e.substr(r.length+1)||void 0}function f(e){return!b.disabled&&(!(!b.externalSources&&!o.isDragging)&&(!b.allowedTypes||null===e||e&&b.allowedTypes.indexOf(e)!=-1))}function u(e,r){var a=d
return r||(a=n(a,e.dataTransfer.effectAllowed)),o.isDragging&&(a=n(a,o.effectAllowed)),s.dndEffectAllowed&&(a=n(a,s.dndEffectAllowed)),a.length?e.ctrlKey&&a.indexOf("copy")!=-1?"copy":e.altKey&&a.indexOf("link")!=-1?"link":a[0]:"none"}function v(){return m.remove(),i.removeClass(C),!0}function p(n,r,a,t,d,i){return e(n)(l,{callback:o.callback,dropEffect:a,event:r,external:!o.isDragging,index:void 0!==d?d:D(),item:i||void 0,type:t})}function D(){return Array.prototype.indexOf.call(w.children,T)}function y(){var e
return angular.forEach(i.children(),function(n){var r=angular.element(n)
r.hasClass(h)&&(e=r)}),e||angular.element("<li class='"+h+"'></li>")}var h="dndPlaceholder",C="dndDragover"
s.dndClassForPlaceholder&&(h=s.dndClassForPlaceholder,l.$watch(s.dndClassForPlaceholder,function(){h=s.dndClassForPlaceholder})),s.dndClassForDragover&&(C=s.dndClassForDragover,l.$watch(s.dndClassForDragover,function(){C=s.dndClassForDragover}))
var m=y()
m.remove()
var T=m[0],w=i[0],b={}
i.on("dragenter",function(e){e=e.originalEvent||e
var n=s.dndAllowedTypes&&l.$eval(s.dndAllowedTypes)
b={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),disabled:s.dndDisableIf&&l.$eval(s.dndDisableIf),externalSources:s.dndExternalSources&&l.$eval(s.dndExternalSources),horizontal:s.dndHorizontalList&&l.$eval(s.dndHorizontalList)}
var r=g(e.dataTransfer.types)
return!r||!f(c(r))||void e.preventDefault()}),i.on("dragover",function(e){e=e.originalEvent||e
var n=g(e.dataTransfer.types),r=c(n)
if(!n||!f(r))return!0
if(T.parentNode!=w&&(i.append(m),o.currentDragItem&&o.currentDragItem.element.addClass(o.currentDragItem.draggingSourceClass)),e.target!=w){for(var a=e.target;a.parentNode!=w&&a.parentNode;)a=a.parentNode
if(a.parentNode==w&&a!=T){var d=a.getBoundingClientRect()
if(b.horizontal)var l=e.clientX<d.left+d.width/2
else var l=e.clientY<d.top+d.height/2
w.insertBefore(T,l?a:a.nextSibling)}}var D=n==t||!e.dataTransfer.effectAllowed,y=u(e,D)
return"none"==y?v():s.dndDragover&&!p(s.dndDragover,e,y,r)?v():(e.preventDefault(),D||(e.dataTransfer.dropEffect=y),i.addClass(C),e.stopPropagation(),!1)}),i.on("drop",function(e){e=e.originalEvent||e
var n=g(e.dataTransfer.types),r=c(n)
if(!n||!f(r))return!0
e.preventDefault()
try{var d=JSON.parse(e.dataTransfer.getData(n))}catch(e){return v()}if((n==t||n==a)&&(r=d.type||void 0,d=d.item,!f(r)))return v()
var i=n==t||!e.dataTransfer.effectAllowed,y=u(e,i)
if("none"==y)return v()
var h=D()
return s.dndDrop&&(d=p(s.dndDrop,e,y,r,h,d),!d)?v():(o.dropEffect=y,i||(e.dataTransfer.dropEffect=y),d!==!0&&l.$apply(function(){l.$eval(s.dndList).splice(h,0,d)}),p(s.dndInserted,e,y,r,h,d),v(),e.stopPropagation(),!1)}),i.on("dragleave",function(e){e=e.originalEvent||e
var n=document.elementFromPoint(e.clientX,e.clientY)
w.contains(n)&&!e._dndPhShown?e._dndPhShown=!0:v()})}}]),e.directive("dndNodrag",function(){return function(e,n,r){n.attr("draggable","true"),n.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,n,r){n.attr("draggable","true"),n.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}})
var o={}}(angular.module("dndLists",[]))
